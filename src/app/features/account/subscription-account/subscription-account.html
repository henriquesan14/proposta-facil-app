@if (data) {
<div class="p-6 space-y-6">
  <!-- Seção da assinatura ativa -->
  @if (data.activeSubscription) {
  <nz-card nzTitle="Assinatura Atual" nzBordered>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <strong>Plano: </strong>
        {{ data.activeSubscription.subscriptionPlan.name }}
      </div>
      <div>
        <strong>Status: </strong>
        <nz-tag [nzColor]="
                data.activeSubscription.status === 'Active'
                  ? 'green'
                  : data.activeSubscription.status === 'Pending'
                  ? 'orange'
                  : 'red'
              ">
          {{ data.activeSubscription.status }}
        </nz-tag>
      </div>
      <div>
        <strong>Preço: </strong> R$
        {{ data.activeSubscription.subscriptionPlan.price | currency: 'BRL' }}
      </div>
      <div>
        <strong>Propostas usadas: </strong>
        {{ data.activeSubscription.proposalsUsed }} /
        {{ data.activeSubscription.subscriptionPlan.maxProposalsPerMonth }}
      </div>
    </div>

    <div class="mt-2">
      @if (data.activeSubscription.status === 'Pending') {
      <button class="me-1" nz-button nzType="primary" [nzLoading]="loadingPayment"
        (click)="openPaymentLink(data.activeSubscription.paymentLink)">
        Pagar agora
      </button>
      }

      <button nz-button nzType="default" (click)="openChangePlanModal()">
        Alterar Plano
      </button>
    </div>
  </nz-card>
  }

  @if (data.activeSubscription && data.activeSubscription.pendingUpgradePlan) {
  <nz-tag [nzColor]="'orange'" class="mt-1">
    Upgrade pendente - {{data.activeSubscription.pendingUpgradePlan.name}}
    {{data.activeSubscription.pendingUpgradePlan.price | currency: 'BRL'}}
  </nz-tag>
  }

  <!-- Histórico de pagamentos -->
  @if(data.payments && data.payments.count > 0){
  <nz-card nzTitle="Histórico de Pagamentos" nzBordered class="mt-1">
    <div class="d-flex justify-content-between align-items-center p-2 mb-2">
      <nz-pagination nzSize="small" [nzTotal]="data.payments.count" [(nzPageIndex)]="data.payments.pageIndex"
        [nzPageSize]="data.payments.pageSize" (nzPageIndexChange)="onPageChange($event)"
        (nzPageSizeChange)="onPageSizeChange($event)" [nzShowSizeChanger]="true" [nzPageSizeOptions]="[2, 5, 10]"
        style="max-width: 600px; width: 100%;">
      </nz-pagination>
    </div>
    <nz-table [nzData]="data.payments.data" [nzFrontPagination]="false" [nzSize]="'small'" [nzBordered]="true">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Status</th>
          <th>Valor</th>
          <th>Forma</th>
          <th>Vencimento</th>
          <th>Pagamento</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        @for (p of data.payments.data; track p.id) {
        <tr>
          <td>
            {{p.description}}
          </td>
          <td>
            <nz-tag [nzColor]="p.status === 'RECEIVED' ? 'green' : 'orange'">
              {{ p.status }}
            </nz-tag>
          </td>
          <td>R$ {{ p.amount | currency: 'BRL' }}</td>
          <td>{{ p.billingType }}</td>
          <td>{{ p.dueDate | date: 'dd/MM/yyyy' }}</td>
          <td>{{ p.paymentDate | date: 'dd/MM/yyyy' }}</td>
          <td>
            @if (p.paymentLink) {
            <a nz-button nzType="link" (click)="openPaymentLink(p.paymentLink)">
              Ver link
            </a>
            }
          </td>
        </tr>
        }
      </tbody>
    </nz-table>
  </nz-card>

  }
</div>
}